#ifndef UTIL_H
#define UTIL_H

#include <array>
#include <bitset>
#include <cstdint>
#include <string>

using std::bitset;
using std::string;

// Typedef

// Default ints to use
// Generally memory is not too critical, prioritize speed
typedef uint_fast32_t uintf;
typedef int_fast32_t intf;

// Ints for memory critical parts
// Generally use in large arrays
typedef uint_least8_t uint8s;
typedef uint_least16_t uint16s;

// Define constants used by the pipeline
// This is for constants used by more than one file
// Otherwise keep the constants in the file that uses it

// Size of game state sample
const uintf GAME_STATE_SIZE = 70;
// Number of possible legal moves
const uintf NUM_MOVES = 96;

const uint8s RESULT_NONE = 0;
const uint8s RESULT_LOSS = 1;
const uint8s RESULT_DRAW = 2;
const uint8s RESULT_WIN = 3;
const uint8s DEDUCED_LOSS = 4;
const uint8s DEDUCED_DRAW = 5;
const uint8s DEDUCED_WIN = 6;

string str_result(uint8s result);

// Indexing for lines
const uintf RL = 0;
const uintf RR = 1;
const uintf RB = 2;
const uintf CU = 3;
const uintf CD = 4;
const uintf CB = 5;

const uintf D0U = 0;
const uintf D0D = 1;
const uintf D0B = 2;
const uintf D1U = 3;
const uintf D1D = 4;
const uintf D1B = 5;
const uintf S0 = 6;
const uintf S1 = 7;
const uintf S2 = 8;
const uintf S3 = 9;

void print_line(uintf line);

inline std::array<bitset<NUM_MOVES>, 102> line_breakers = {
    bitset<NUM_MOVES>("00000000000000000000000000000111000000000000100000"
                      "0000000111000000000100000000000000000000000000"),
    bitset<NUM_MOVES>("00000000000001110000000000001000000000000000000000"
                      "0000001111000000000100000000000111000000000100"),
    bitset<NUM_MOVES>("00000000000010000000000000000000000000000000000000"
                      "0000001000000000000000000000000111000000000100"),
    bitset<NUM_MOVES>("00000000000000000000000001110000000000001000000000"
                      "0001110000000000100000000000000111000000000000"),
    bitset<NUM_MOVES>("00000000011100000000000010000000000000000000000000"
                      "0011110111000000100000000001111111000000100000"),
    bitset<NUM_MOVES>("00000000100000000000000000000000000000000000000000"
                      "0010000111000000000000000001111000000000100000"),
    bitset<NUM_MOVES>("00000000000000000000011100000000000010000000000001"
                      "1100000000000100000000000001110000000000000000"),
    bitset<NUM_MOVES>("00000111000000000000100000000000000000000000000001"
                      "1101110000100100000000011111110000000100000000"),
    bitset<NUM_MOVES>("00001000000000000000000000000000000000000000000010"
                      "0001110000000000000000011110000000000100000000"),
    bitset<NUM_MOVES>("00000000000000000111000000000000100000000000000000"
                      "0000000000100000000000011100000000000000000000"),
    bitset<NUM_MOVES>("01110000000000001000000000000000000000000000000001"
                      "1100000000100000000000111100000000100000000000"),
    bitset<NUM_MOVES>("10000000000000000000000000000000000000000000000001"
                      "1100000000000000000000100000000000100000000000"),
    bitset<NUM_MOVES>("00000000000000000000000000001110000000000000000100"
                      "0000001110000000000000000000000000000000000001"),
    bitset<NUM_MOVES>("00000000000011100000000000000001000000000000000000"
                      "0000001111000000000001000000001110000000000001"),
    bitset<NUM_MOVES>("00000000000000010000000000000000000000000000000000"
                      "0000000001000000000001000000001110000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000011100000000000000001000000"
                      "0011100000000000000000000000001110000000001000"),
    bitset<NUM_MOVES>("00000000111000000000000000010000000000000000000000"
                      "0011111110000000001000000011101111000000001000"),
    bitset<NUM_MOVES>("00000000000100000000000000000000000000000000000000"
                      "0000011110000000001000000011100001000000000000"),
    bitset<NUM_MOVES>("00000000000000000000111000000000000000010000000011"
                      "1000000000000000000000000011100000000001000000"),
    bitset<NUM_MOVES>("00001110000000000000000100000000000000000000000011"
                      "1111100000000001000000111011110000000001000000"),
    bitset<NUM_MOVES>("00000001000000000000000000000000000000000000000000"
                      "0111100000000001000000111000010000000000000000"),
    bitset<NUM_MOVES>("00000000000000001110000000000000000100000000000000"
                      "0000000000000000000000111000000000001000000000"),
    bitset<NUM_MOVES>("11100000000000000001000000000000000000000000000011"
                      "1000000000001000000000111100000000001000000000"),
    bitset<NUM_MOVES>("00010000000000000000000000000000000000000000000011"
                      "1000000000001000000000000100000000000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000000000110000000000000000000"
                      "0000000110000000000000000000000000000000000000"),
    bitset<NUM_MOVES>("00000000000001100000000000000000000000000000000000"
                      "0000000110000000000000000000000110000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000000000000000000000000000000110000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000001100000000000000000000000"
                      "0001100000000000000000000000000110000000000000"),
    bitset<NUM_MOVES>("00000000011000000000000000000000000000000000000000"
                      "0001100110000000000000000001100110000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000000110000000000000000001100000000000000000"),
    bitset<NUM_MOVES>("00000000000000000000011000000000000000000000000001"
                      "1000000000000000000000000001100000000000000000"),
    bitset<NUM_MOVES>("00000110000000000000000000000000000000000000000001"
                      "1001100000000000000000011001100000000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0001100000000000000000011000000000000000000000"),
    bitset<NUM_MOVES>("00000000000000000110000000000000000000000000000000"
                      "0000000000000000000000011000000000000000000000"),
    bitset<NUM_MOVES>("01100000000000000000000000000000000000000000000001"
                      "1000000000000000000000011000000000000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000001"
                      "1000000000000000000000000000000000000000000000"),
    bitset<NUM_MOVES>("00000000000000000000000100010001000100000000000000"
                      "0100000000000001001001000000000000000000000000"),
    bitset<NUM_MOVES>("00000001000100010001000000000000000000000000000000"
                      "0100000000001001001001000100000000000001001001"),
    bitset<NUM_MOVES>("00010000000000000000000000000000000000000000000000"
                      "0000000000001000000000000100000000000001001001"),
    bitset<NUM_MOVES>("00000000000000000000001000100010001000000000000000"
                      "1000000000000010010010000000000000000001001001"),
    bitset<NUM_MOVES>("00000010001000100010000000000000000000000000000000"
                      "1000000000010011011011001000000000001011011011"),
    bitset<NUM_MOVES>("00100000000000000000000000000000000000000000000000"
                      "0000000000010001001001001000000000001010010010"),
    bitset<NUM_MOVES>("00000000000000000000010001000100010000000000000001"
                      "0000000000000100100100000000000000000010010010"),
    bitset<NUM_MOVES>("00000100010001000100000000000000000000000000000001"
                      "0000000000100110110110010000000000010110110110"),
    bitset<NUM_MOVES>("01000000000000000000000000000000000000000000000000"
                      "0000000000100010010010010000000000010100100100"),
    bitset<NUM_MOVES>("00000000000000000000100010001000100000000000000010"
                      "0000000000000000000000000000000000000100100100"),
    bitset<NUM_MOVES>("00001000100010001000000000000000000000000000000010"
                      "0000000000000100100100100000000000100100100100"),
    bitset<NUM_MOVES>("10000000000000000000000000000000000000000000000000"
                      "0000000000000100100100100000000000100000000000"),
    bitset<NUM_MOVES>("00000000000000000001000100010000000000000000000100"
                      "0000000000001001001000000000000001000000000000"),
    bitset<NUM_MOVES>("00010001000100000000000000000001000000000000000000"
                      "0000000001001001001001000000000001001001001000"),
    bitset<NUM_MOVES>("00000000000000010000000000000000000000000000000000"
                      "0000000001000000000001000000000000001001001000"),
    bitset<NUM_MOVES>("00000000000000000010001000100000000000000000001000"
                      "0000000000010010010000000000000010001001001000"),
    bitset<NUM_MOVES>("00100010001000000000000000000010000000000000000000"
                      "0000000010011011011010000000000010011011011001"),
    bitset<NUM_MOVES>("00000000000000100000000000000000000000000000000000"
                      "0000000010001001001010000000000000010010010001"),
    bitset<NUM_MOVES>("00000000000000000100010001000000000000000000010000"
                      "0000000000100100100000000000000100010010010000"),
    bitset<NUM_MOVES>("01000100010000000000000000000100000000000000000000"
                      "0000000100110110110100000000000100110110110010"),
    bitset<NUM_MOVES>("00000000000001000000000000000000000000000000000000"
                      "0000000100010010010100000000000000100100100010"),
    bitset<NUM_MOVES>("00000000000000001000100010000000000000000000100000"
                      "0000000000000000000000000000001000100100100000"),
    bitset<NUM_MOVES>("10001000100000000000000000001000000000000000000000"
                      "0000001000100100100000000000001000100100100100"),
    bitset<NUM_MOVES>("00000000000010000000000000000000000000000000000000"
                      "0000001000100100100000000000000000000000000100"),
    bitset<NUM_MOVES>("00000000000000000000000100010000000000000000000000"
                      "0000000000000001001000000000000000000000000000"),
    bitset<NUM_MOVES>("00000001000100000000000000000000000000000000000000"
                      "0000000000000001001000000000000000000001001000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000000000000000000000000000000000000001001000"),
    bitset<NUM_MOVES>("00000000000000000000001000100000000000000000000000"
                      "0000000000000010010000000000000000000001001000"),
    bitset<NUM_MOVES>("00000010001000000000000000000000000000000000000000"
                      "0000000000000011011000000000000000000011011000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000000000000001001000000000000000000010010000"),
    bitset<NUM_MOVES>("00000000000000000000010001000000000000000000000000"
                      "0000000000000100100000000000000000000010010000"),
    bitset<NUM_MOVES>("00000100010000000000000000000000000000000000000000"
                      "0000000000000110110000000000000000000110110000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000000000000010010000000000000000000100100000"),
    bitset<NUM_MOVES>("00000000000000000000100010000000000000000000000000"
                      "0000000000000000000000000000000000000100100000"),
    bitset<NUM_MOVES>("00001000100000000000000000000000000000000000000000"
                      "0000000000000100100000000000000000000100100000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000000000000100100000000000000000000000000000"),
    bitset<NUM_MOVES>("00000000000000000000010000100001100000000000000001"
                      "0000100001000100010001000000000110000010001000"),
    bitset<NUM_MOVES>("00000100001000011000000000000000000000000000000001"
                      "0001100011000110011001110000100111100110011001"),
    bitset<NUM_MOVES>("10000000000000000000000000000000000000000000000000"
                      "0001000010000010001000110000100001100100010001"),
    bitset<NUM_MOVES>("00000000000000001000010000100000000000000000000101"
                      "0000100000000100010000100000000110100010001000"),
    bitset<NUM_MOVES>("10000100001000000000000000000001000000000000000011"
                      "0001100011100110011001110000100110100110011000"),
    bitset<NUM_MOVES>("00000000000000010000000000000000000000000000000010"
                      "0001000011100010001001010000100000000100010000"),
    bitset<NUM_MOVES>("00000000000000000000010000100000000000000000000001"
                      "0000100000000100010000000000000110000010001000"),
    bitset<NUM_MOVES>("00000100001000000000000000000000000000000000000001"
                      "0001100010000110011000010000100110000110011000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0001000010000010001000010000100000000100010000"),
    bitset<NUM_MOVES>("00000000000000000000001001001000000100000000000000"
                      "1001001000000010100000000000000110000001010100"),
    bitset<NUM_MOVES>("00000010010010000001000000000000000000000000000000"
                      "1001101100001011110100001101001110000011110100"),
    bitset<NUM_MOVES>("00010000000000000000000000000000000000000000000000"
                      "0000100100001001010100001101001000000010100000"),
    bitset<NUM_MOVES>("00000000000000000001001001000000000000000000100000"
                      "1001000000001010100000000100000110000001010000"),
    bitset<NUM_MOVES>("00010010010000000000000000001000000000000000000000"
                      "1101101100001011110000001101000110001011110100"),
    bitset<NUM_MOVES>("00000000000010000000000000000000000000000000000000"
                      "0100101100000001010000001001000000001010100100"),
    bitset<NUM_MOVES>("00000000000000000000001001000000000000000000000000"
                      "1001000000000010100000000000000110000001010000"),
    bitset<NUM_MOVES>("00000010010000000000000000000000000000000000000000"
                      "1001100100000011110000001001000110000011110000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000100100000001010000001001000000000010100000"),
    bitset<NUM_MOVES>("00000000000000000000000100100100000000000000000000"
                      "0100100100000001010100000000010010000000001010"),
    bitset<NUM_MOVES>("00000001001001000000000000000000000000000000000000"
                      "0100110110000001011110000100110110000001011110"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0000010010000000001010000100100100000001010100"),
    bitset<NUM_MOVES>("00000000000000000000100001000010000000000000000010"
                      "0001000010000000100010000010000100000100010001"),
    bitset<NUM_MOVES>("00001000010000100000000000000000000000000000000010"
                      "0011000110000100110011100011000110000100110011"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "0010000100000100010001100001000010000000100010"),
    bitset<NUM_MOVES>("00000000000000000010010010000000000000000000000001"
                      "0010000000010100000000001001001000001010100000"),
    bitset<NUM_MOVES>("00100100100000000000000000000000000000000000000001"
                      "1011001000011110100000011011001000011110100000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000000"
                      "1001001000001010100000010010000000010100000000"),
    bitset<NUM_MOVES>("00000000000000000100001000010000000000000000000000"
                      "1000010000100010001000010000100001010001000000"),
    bitset<NUM_MOVES>("01000010000100000000000000000000000000000000000001"
                      "1000110001110011001000011000110001110011001000"),
    bitset<NUM_MOVES>("00000000000000000000000000000000000000000000000001"
                      "0000100001010001000000001000010000100010001000"),
};

const uintf GAMMA_BUCKETS = 1024;

const float gamma_samples[GAMMA_BUCKETS] = {
    1.4868120409271554e-11, 2.84847563328348e-10,   1.437169715346044e-09,
    4.3049973568822985e-09, 9.847816177857643e-09,  1.912371017958967e-08,
    3.3273452646543274e-08, 5.3509858788543365e-08, 8.111004634501829e-08,
    1.1740950228868349e-07, 1.6379736002137218e-07, 2.2171253314136635e-07,
    2.9264048065950303e-07, 3.78110452870524e-07,   4.796931126736937e-07,
    5.989984564768895e-07,  7.376739784599229e-07,  8.974030355569619e-07,
    1.0799033801770187e-06, 1.2869258347136456e-06, 1.5202530871213644e-06,
    1.7816985907923974e-06, 2.0731055550062147e-06, 2.396346014598278e-06,
    2.7533199693658715e-06, 3.1459545852248804e-06, 3.5762034503422286e-06,
    4.046045880450787e-06,  4.557486268363303e-06,  5.1125534733743e-06,
    5.713300246795446e-06,  6.361802690345206e-06,  7.060159744507497e-06,
    7.810492704312353e-06,  8.614944760285067e-06,  9.475680562554496e-06,
    1.0394885806329978e-05, 1.1374766837140094e-05, 1.2417550274390815e-05,
    1.3525482651940294e-05, 1.4700830074514581e-05, 1.5945877888901457e-05,
    1.7262930368944915e-05, 1.8654310413465783e-05, 2.012235925630115e-05,
    2.1669436187717993e-05, 2.3297918286532637e-05, 2.5010200162312282e-05,
    2.6808693707077724e-05, 2.869582785599562e-05,  3.0674048356556564e-05,
    3.274581754580474e-05,  3.491361413517749e-05,  3.717993300259181e-05,
    3.9547284991410455e-05, 4.20181967159232e-05,   4.4595210373073985e-05,
    4.7280883560123356e-05, 5.0077789097964646e-05, 5.298851485983159e-05,
    5.6015663605191887e-05, 5.9161852818577975e-05, 6.242971455314442e-05,
    6.582189527875199e-05,  6.934105573440048e-05,  7.298987078483411e-05,
    7.677102928115273e-05,  8.068723392527631e-05,  8.474120113810809e-05,
    8.893566093123846e-05,  9.327335678211095e-05,  9.775704551248913e-05,
    0.00010238949717009566, 0.0001071734949133441,  0.00011211183489900401,
    0.00011720732617281096, 0.0001224627905627941,  0.00012788106257525733,
    0.00013346498929344672, 0.00013921743027865536, 0.00014514125747379188,
    0.00015123935510931525, 0.00015751461961144208, 0.0001639699595125904,
    0.00017060829536398624, 0.0001774325596503367,  0.00018444569670653818,
    0.0001916506626364145,  0.00019905042523332955, 0.00020664796390268398,
    0.0002144462695862618,  0.00022244834468829145, 0.0002306572030032888,
    0.0002390758696455857,  0.00024770738098050496, 0.00025655478455704296,
    0.00026562113904228047, 0.0002749095141572862,  0.00028442299061432207,
    0.00029416466005576143, 0.00030413762499430127, 0.0003143449987546004,
    0.0003247899054162352,  0.0003354754797581406,  0.0003464048672041332,
    0.0003575812237697599,  0.0003690077160107634,  0.00038068752097225665,
    0.0003926238261392899,  0.0004048198293887641,  0.00041727873894238556,
    0.00043000377332069923, 0.00044299816129815745, 0.000456265141859718,
    0.00046980796415804,    0.00048362988747173994, 0.0004977341811652284,
    0.0005121241246489745,  0.0005268030073410173,  0.0005417741286295177,
    0.0005570407978361497,  0.0005726063341806182,  0.0005884740667459065,
    0.0006046473344446347,  0.0006211294859862633,  0.0006379238798451165,
    0.000655033884229544,   0.000672462877051739,   0.0006902142458982467,
    0.0007082913880018615,  0.0007266977102140649,  0.0007454366289779566,
    0.000764511570302584,   0.0007839259697379639,  0.0008036832723504607,
    0.0008237869326993965,  0.0008442404148144889,  0.00086504719217359,
    0.0008862107476816608,  0.0009077345736504354,  0.0009296221717783233,
    0.000951877053131877,   0.0009745027381275474,  0.0009975027565137138,
    0.0010208806473544333,  0.0010446399590131265,  0.0010687842491369753,
    0.001093317084642781,   0.0011182420417026684,  0.0011435627057305763,
    0.0011692826713701086,  0.0011954055424822148,  0.0012219349321338114,
    0.0012488744625876707,  0.0012762277652921112,  0.0013039984808715255,
    0.0013321902591180567,  0.001360806758983347,   0.0013898516485712179,
    0.0014193286051308951,  0.0014492413150509946,  0.0014795934738538914,
    0.001510388786190633,   0.001541630965837243,   0.0015733237356905375,
    0.0016054708277652276,  0.0016380759831917814,  0.0016711429522140325,
    0.0017046754941884013,  0.0017386773775830632,  0.0017731523799779597,
    0.0018081042880655639,  0.0018435368976514167,  0.0018794540136563172,
    0.0019158594501185358,  0.0019527570301967707,  0.001990150586173482,
    0.002028043959459023,   0.00206644100059616,    0.0021053455692650962,
    0.0021447615342894562,  0.002184692773642926,   0.0022251431744556736,
    0.002266116633021436,   0.0023076170548064156,  0.002349648354457513,
    0.0023922144558112014,  0.0024353192919033765,  0.002478966804979663,
    0.002523160946506226,   0.0025679056771810214,  0.002613204966945803,
    0.002659062794998585,   0.002705483149806562,   0.002752470029119715,
    0.002800027439984984,   0.0028481593987612188,  0.0028968699311331648,
    0.0029461630721284333,  0.002996042866134606,   0.0030465133669138975,
    0.003097578637621372,   0.0031492427508237274,  0.0032015097885172007,
    0.003254383842146376,   0.0033078690126239437,  0.003361969410351086,
    0.0034166891552376557,  0.003472032376723624,   0.003528003213801104,
    0.003584605815036577,   0.0036418443385932346,  0.0036997229522544943,
    0.003758245833448481,   0.0038174171692721246,  0.0038772411565160354,
    0.003937722001690671,   0.003998863921051743,   0.00406067114062705,
    0.004123147896244233,   0.004186298433557805,   0.004250127008077801,
    0.004314637885198836,   0.004379835340229308,   0.004445723658421117,
    0.0045123071350004675,  0.004579590075199121,   0.0046475767942855154,
    0.004716271617597585,   0.004785678880574687,   0.004855802928790794,
    0.004926648117989771,   0.004998218814119008,   0.005070519393364717,
    0.005143554242183286,   0.005217327757344143,   0.0052918443459653245,
    0.005367108425544844,   0.005443124424003713,   0.005519896779724192,
    0.005597429941583756,   0.005675728369001573,   0.005754796531974383,
    0.005834638911116278,   0.005915259997705564,   0.005996664293719379,
    0.006078856311879781,   0.0061618405756963405,  0.006245621619509904,
    0.00633020398853543,    0.006415592238909758,   0.006501790937733293,
    0.006588804663115879,   0.006676638004227066,   0.006765295561340317,
    0.006854781945881128,   0.006945101780475297,   0.007036259698998191,
    0.007128260346623741,   0.007221108379875043,   0.007314808466674539,
    0.007409365286395623,   0.00750478352991486,    0.007601067899663341,
    0.007698223109681763,   0.007796253885673334,   0.00789516496505627,
    0.007994961097021478,   0.008095647042587509,   0.008197227574656544,
    0.008299707478071657,   0.008403091549673416,   0.00850738459835917,
    0.00861259144514117,    0.008718716923206991,   0.008825765877980306,
    0.00893374316717856,    0.009042653660875737,   0.009152502241564891,
    0.009263293804228656,   0.009375033256387253,   0.009487725518167955,
    0.009601375522381045,   0.00971598821457204,    0.009831568553093535,
    0.009948121509171511,   0.010065652066971822,   0.010184165223667005,
    0.010303665989510226,   0.01042415938790241,    0.010545650455459797,
    0.010668144242086454,   0.01079164581104836,    0.010916160239045144,
    0.011041692616280857,   0.011168248046538867,   0.011295831647255615,
    0.011424448549601708,   0.01155410389854892,    0.011684802852954921,
    0.011816550585637905,   0.011949352283449937,   0.01208321314736446,
    0.012218138392551139,   0.012354133248457235,   0.012491202958893909,
    0.012629352782102353,   0.012768587990853984,   0.01290891387253724,
    0.013050335729221178,   0.013192858877756217,   0.013336488649856443,
    0.013481230392184334,   0.013627089466444989,   0.013774071249469827,
    0.0139221811333007,     0.014071424525288739,   0.01422180684818456,
    0.01437333354022173,    0.014526010055219326,   0.014679841862670682,
    0.014834834447836232,   0.014990993311844761,   0.015148323971779797,
    0.01530683196078021,    0.015466522828153589,   0.015627402139451706,
    0.015789475476567026,   0.015952748437860632,   0.016117226638246235,
    0.01628291570929405,    0.016449821299328822,   0.016617949073541437,
    0.01678730471410105,    0.01695789392023832,    0.017129722408363714,
    0.01730279591219066,    0.017477120182826242,   0.017652700988877088,
    0.017829544116574947,   0.01800765536988052,    0.018187040570595676,
    0.018367705558478015,   0.01854965619135934,    0.01873289834525346,
    0.018917437914474696,   0.019103280811763334,   0.019290432968394108,
    0.019478900334302017,   0.01966868887820003,    0.019859804587708113,
    0.020052253469458013,   0.02024604154923502,    0.020441174872101103,
    0.020637659502505137,   0.020835501524434398,   0.02103470704152641,
    0.021235282177191787,   0.02143723307475869,    0.021640565897603242,
    0.021845286829279203,   0.02205140207364917,    0.022258917855020037,
    0.022467840418283046,   0.022678176029046634,   0.022889930973778845,
    0.023103111559944624,   0.023317724116145046,   0.023533774992262012,
    0.023751270559603622,   0.0239702172110424,     0.024190621361162404,
    0.024412489446411677,   0.024635827925246937,   0.024860643278278464,
    0.025086942008425612,   0.025314730641085716,   0.025544015724249088,
    0.025774803828671478,   0.026007101548048583,   0.02624091549916002,
    0.026476252322017602,   0.02671311868002615,    0.026951521260166155,
    0.02719146677313904,    0.027432961953528876,   0.02767601355998887,
    0.0279206283753856,     0.028166813206958335,   0.028414574886535805,
    0.02866392027066537,    0.02891485624078629,    0.029167389703432012,
    0.029421527590382135,   0.029677276858845872,   0.029934644491641876,
    0.030193637497391464,   0.030454262910673664,   0.030716527792224738,
    0.03098043922912595,    0.031246004334978057,   0.031513230250104884,
    0.031782124141731045,   0.03205269320417503,    0.03232494465904448,
    0.03259888575543629,    0.032874523770121254,   0.03315186600775266,
    0.03343091980106662,    0.033711692511066434,   0.03399419152723757,
    0.03427842426777058,    0.034564398179742405,   0.03485212073932501,
    0.03514159945201139,    0.035432841852823825,   0.035725855506516996,
    0.036020648007807035,   0.036317226981584586,   0.03661560008312479,
    0.0369157749983257,     0.037217759443928626,   0.03752156116772669,
    0.03782718794881208,    0.0381346475977996,     0.03844394795705123,
    0.038755096900920175,   0.03906810233597168,    0.03938297220123595,
    0.039699714468454994,   0.040018337142294476,   0.04033884826060262,
    0.0406612558946664,     0.04098556814945281,    0.041311793163857885,
    0.041639939110944754,   0.04197001419823304,    0.04230202666793153,
    0.042635984797189726,   0.04297189689838219,    0.04330977131936376,
    0.0436496164437302,     0.0439914406910931,     0.044335252517348205,
    0.04468106041494745,    0.04502887291318421,    0.045378698578462155,
    0.045730546014573735,   0.04608442386299221,    0.046440340803152784,
    0.04679830555275082,    0.047158326868020246,   0.04752041354402664,
    0.04788457441497319,    0.04825081835449883,    0.048619154275971695,
    0.04898959113279802,    0.049362137918746274,   0.04973680366821661,
    0.05011359745659714,    0.050492528400561905,   0.05087360565837711,
    0.05125683843023639,    0.05164223595858985,    0.052029807528468405,
    0.052419562467802855,   0.05281151014777057,    0.05320565998312352,
    0.05360202143252953,    0.05400060399892615,    0.05440141722985729,
    0.05480447071781428,    0.055209774100602745,   0.055617337061694645,
    0.05602716933058588,    0.05643928068315068,    0.05685368094201383,
    0.057270379976937055,   0.05768938770516335,    0.05811071409179693,
    0.05853436915021216,    0.05896036294239777,    0.05938870557936435,
    0.05981940722154676,    0.060252478079168496,   0.06068792841265571,
    0.061125768533045605,   0.061566008802381875,   0.062008659634123685,
    0.06245373149355194,    0.0629012348982129,     0.06335118041831583,
    0.063803578677159,      0.06425844035157621,    0.06471577617234882,
    0.06517559692466185,    0.06563791344851977,    0.06610273663921869,
    0.06657007744780027,    0.06703994688147483,    0.06751235600411973,
    0.06798731593669508,    0.06846483785774947,    0.06894493300390234,
    0.06942761267026318,    0.0699128882109919,     0.07040077103972327,
    0.07089127263007404,    0.07138440451616235,    0.07188017829306652,
    0.07237860561737129,    0.07287969820767391,    0.07338346784507041,
    0.07388992637370786,    0.07439908570130278,    0.07491095779965208,
    0.07542555470519569,    0.07594288851954996,    0.07646297141007116,
    0.0769858156103764,     0.07751143342091742,    0.07803983720954352,
    0.07857103941209428,    0.07910505253295505,    0.07964188914561073,
    0.08018156189329262,    0.08072408348953715,    0.08126946671878205,
    0.08181772443698697,    0.08236886957223102,    0.08292291512535178,
    0.08347987417054079,    0.08403975985601135,    0.08460258540462044,
    0.08516836411445906,    0.0857371093596048,     0.0863088345907208,
    0.0868835533356899,     0.08746127920035505,    0.08804202586916528,
    0.08862580710584794,    0.08921263675410215,    0.08980252873834256,
    0.09039549706436142,    0.09099155582003648,    0.09159071917611246,
    0.09219300138684801,    0.09279841679080018,    0.0934069798116115,
    0.09401870495868926,    0.09463360682798033,    0.09525170010277684,
    0.09587299955446064,    0.09649752004332032,    0.09712527651932767,
    0.09775628402290841,    0.09839055768581008,    0.09902811273188947,
    0.09966896447795884,    0.10031312833463468,    0.10096061980711903,
    0.10161145449615422,    0.10226564809883311,    0.10292321640941589,
    0.10358417532037353,    0.10424854082315425,    0.10491632900910335,
    0.10558755607043037,    0.10626223830108293,    0.10694039209770631,
    0.10762203396059707,    0.108307180494652,      0.10899584841030377,
    0.10968805452452884,    0.11038381576188287,    0.11108314915542301,
    0.11178607184772069,    0.11249260109194717,    0.11320275425285276,
    0.11391654880783045,    0.11463400234799474,    0.11535513257923245,
    0.11607995732327897,    0.11680849451881668,    0.11754076222259015,
    0.11827677861050875,    0.11901656197879378,    0.11976013074514358,
    0.1205075034498678,     0.12125869875705038,    0.12201373545574186,
    0.12277263246119183,    0.12353540881603421,    0.1243020836915133,
    0.12507267638872,       0.1258472063398886,     0.1266256931096636,
    0.12740815639629652,    0.12819461603306637,    0.12898509198957364,
    0.1297796043730134,     0.13057817342956818,    0.13138081954577663,
    0.13218756324992625,    0.1329984252134119,     0.133813426252178,
    0.13463258732813554,    0.1354559295506631,     0.13628347417802814,
    0.1371152426188455,     0.1379512564336578,     0.1387915373364093,
    0.13963610719596375,    0.1404849880377045,     0.14133820204517403,
    0.14219577156153612,    0.14305771909127998,    0.1439240673018357,
    0.14479483902521356,    0.14567005725978377,    0.14654974517183297,
    0.1474339260973914,     0.14832262354394346,    0.14921586119216693,
    0.15011366289774275,    0.1510160526931666,     0.15192305478963677,
    0.15283469357881377,    0.15375099363475322,    0.15467197971579869,
    0.15559767676648384,    0.15652810991957225,    0.15746330449794882,
    0.15840328601665654,    0.15934808018498609,    0.1602977129084121,
    0.1612522102907206,     0.1622115986361822,     0.16317590445161528,
    0.16414515444862776,    0.16511937554574294,    0.1660985948706256,
    0.16708283976240768,    0.16807213777390181,    0.16906651667391212,
    0.17006600444962272,    0.17107062930899594,    0.17208041968306012,
    0.17309540422846473,    0.1741156118299377,     0.17514107160274145,
    0.1761718128952491,     0.17720786529152024,    0.1782492586138967,
    0.17929602292565636,    0.18034818853369278,    0.18140578599125595,
    0.18246884610066147,    0.18353739991612053,    0.1846114787465634,
    0.18569111415845008,    0.1867763379788868,     0.18786718229831764,
    0.18896367947362191,    0.19006586213123428,    0.19117376317017426,
    0.19228741576508135,    0.1934068533694237,     0.19453210971885632,
    0.19566321883422888,    0.1968002150250746,     0.19794313289291787,
    0.19909200733460963,    0.20024687354586504,    0.2014077670247162,
    0.20257472357505696,    0.2037477793102452,     0.20492697065676777,
    0.20611233435794876,    0.20730390747764568,    0.20850172740420936,
    0.2097058318542582,     0.21091625887651969,    0.21213304685593876,
    0.21335623451773889,    0.21458586093150644,    0.21582196551528066,
    0.21706458803988485,    0.218313768633134,      0.21956954778421534,
    0.22083196634825317,    0.22210106555056544,    0.22337688699135816,
    0.22465947265038386,    0.2259488648915664,     0.2272451064678268,
    0.22854824052585443,    0.22985831061110687,    0.23117536067277694,
    0.23249943506886683,    0.23383057857138265,    0.23516883637148472,
    0.23651425408489127,    0.23786687775720272,    0.23922675386943454,
    0.2405939293436991,     0.24196845154853036,    0.24335036830498558,
    0.24473972789241247,    0.2461365790542138,     0.247540971004123,
    0.24895295343211654,    0.25037257651073985,    0.2517998909015212,
    0.253234947761252,      0.25467779874859986,    0.2561284960308006,
    0.2575870922903605,     0.259053640731883,      0.26052819508916053,
    0.262010809632172,      0.26350153917431124,    0.26500043907980747,
    0.2665075652711316,     0.26802297423651844,    0.26954672303774546,
    0.27107886931805314,    0.2726194713100009,     0.274168587843547,
    0.2757262783544596,     0.2772926028926312,     0.2788676221305837,
    0.280451397372196,      0.2820439905615333,     0.2836454642918627,
    0.2852558818147415,     0.28687530704943315,    0.288503804592297,
    0.29014143972639594,    0.2917882784313478,     0.29344438739346834,
    0.29510983401567453,    0.296784686427915,      0.2984690134978785,
    0.30016288484147974,    0.3018663708339694,     0.3035795426208631,
    0.30530247212932365,    0.3070352320798338,     0.3087778959978005,
    0.31053053822547194,    0.31229323393420416,    0.3140660591368803,
    0.3158490907003771,     0.31764240635858637,    0.31944608472556285,
    0.32126020530870847,    0.32308484852256636,    0.324920095702579,
    0.3267660291192802,     0.3286227319926336,     0.330490288506733,
    0.3323687838248061,     0.3342583041044049,     0.3361589365131557,
    0.33807076924430957,    0.33999389153301013,    0.34192839367297573,
    0.34387436703303914,    0.3458319040743778,     0.347801098368109,
    0.3497820446129179,     0.35177483865348447,    0.3537795774988256,
    0.35579635934122833,    0.3578252835757527,     0.359866450819721,
    0.3619199629329887,     0.36398592303845934,    0.3660644355427575,
    0.36815560615802373,    0.37025954192349986,    0.3723763512277812,
    0.37450614383164715,    0.3766490308912312,     0.3788051249818553,
    0.3809745401221055,     0.3831573917984772,     0.38535379699086814,
    0.38756387419847815,    0.38978774346569417,    0.39202552640946225,
    0.3942773462467146,     0.3965433278222861,     0.39882359763785735,
    0.40111828388133536,    0.40342751645684494,    0.4057514270153102,
    0.4080901489858715,     0.4104438176080586,     0.4128125699646332,
    0.4151965450150026,     0.41759588362949573,    0.4200107286247145,
    0.42244122479922996,    0.42488751897010635,    0.427349760011007,
    0.4298280988903388,     0.43232268871042173,    0.4348336847481411,
    0.43736124449596886,    0.4399055277042844,     0.4424666964244455,
    0.44504491505293114,    0.4476403503769803,     0.45025317162092826,
    0.45288355049348983,    0.45553166123649336,    0.45819768067491845,
    0.460881788268244,      0.4635841661622308,     0.46630499924273233,
    0.46904447519115045,    0.47180278454061725,    0.4745801207335463,
    0.47737668018105833,    0.48019266232413405,    0.48302826969555884,
    0.4858837079840133,     0.48875918609981855,    0.4916549162421271,
    0.49457111396784104,    0.49750799826287345,    0.500465791614946,
    0.503444720087976,      0.5064450133987537,     0.5094669049962657,
    0.5125106321420029,     0.5155764359933361,     0.5186645616888923,
    0.521775258435965,      0.5249087796011359,     0.5280653828023121,
    0.5312453300043246,     0.5344488876167344,     0.5376763265941833,
    0.5409279225404179,     0.5442039558143428,     0.5475047116393408,
    0.5508304802161892,     0.5541815568388794,     0.5575582420142086,
    0.5609608415840283,     0.56438966685184,       0.5678450347130822,
    0.5713272677892,        0.5748366945657879,     0.57837364953428,
    0.5819384733391674,     0.5855315129288112,     0.5891531217111063,
    0.5928036597140107,     0.5964834937510086,     0.6001929975918822,
    0.6039325521387693,     0.6077025456080692,     0.6115033737174195,
    0.6153354398796956,     0.6191991554024124,     0.6230949396940008,
    0.6270232204770894,     0.630984434008275,      0.6349790253056051,
    0.6390074483833804,     0.6430701664952212,     0.6471676523847355,
    0.6513003885453762,     0.6554688674890917,     0.659673592023647,
    0.6639150755405577,     0.6681938423124711,     0.672510427800829,
    0.6768653789754743,     0.6812592546445915,     0.6856926257965688,
    0.6901660759556294,     0.6946802015488192,     0.6992356122873957,
    0.7038329315619938,     0.7084727968525034,     0.7131558601542254,
    0.717882788418903,      0.7226542640134924,     0.7274709851964799,
    0.7323336666118845,     0.7372430398036375,     0.7421998537501003,
    0.7472048754187334,     0.7522588903442665,     0.7573627032294119,
    0.7625171385702902,     0.7677230413076174,     0.7729812775040386,
    0.7782927350506933,     0.7836583244030394,     0.7890789793474612,
    0.7945556578012076,     0.800089342647165,      0.805681042603336,
    0.8113317931315797,     0.8170426573870342,     0.8228147272087886,
    0.8286491241552655,     0.8345470005870951,     0.8405095408000383,
    0.8465379622090712,     0.8526335165883555,     0.8587974913695754,
    0.8650312110022002,     0.8713360383790001,     0.8777133763299491,
    0.8841646691903706,     0.8906914044457427,     0.8972951144585528,
    0.9039773782821403,     0.9107398235678084,     0.9175841285692568,
    0.924512024250597,      0.9315252965056462,     0.9386257884952381,
    0.9458154031092336,     0.9530961055618346,     0.9604699261296987,
    0.9679389630407326,     0.975505385525946,      0.9831714370428364,
    0.9909394386825368,     0.9988117927764227,     1.0067909867134968,
    1.0148795969819853,     1.0230802934552654,     1.0313958439383748,
    1.0398291189912696,     1.048383097053585,      1.0570608698932868,
    1.0658656484000903,     1.0748007687546532,     1.0838696990013883,
    1.0930760460553766,     1.1024235631808876,     1.111916157979223,
    1.1215579009271588,     1.1313530345107488,     1.1413059830106171,
    1.1514213629893448,     1.1617039945416898,     1.1721589133819688,
    1.182791383837818,      1.1936069128355618,     1.2046112649686531,
    1.2158104787511332,     1.2272108841714588,     1.2388191216704407,
    1.2506421626861177,     1.262687331921179,      1.2749623315128498,
    1.2874752672988876,     1.3002346774028424,     1.3132495633906178,
    1.3265294242764483,     1.3400842937014612,     1.3539247806409025,
    1.3680621140528426,     1.3825081919336224,     1.3972756353106146,
    1.4123778477813724,     1.4278290812975323,     1.4436445089913226,
    1.4598403059690592,     1.4764337391460554,     1.493443267351252,
    1.5108886531498698,     1.5287910880678564,     1.547173333185047,
    1.5660598774183587,     1.5854771162288044,     1.6054535539947705,
    1.6260200339159305,     1.64721000005029,       1.6690597970315604,
    1.6916090141517162,     1.7149008819143106,     1.7389827309579649,
    1.7639065254821342,     1.7897294861649335,     1.8165148211904083,
    1.844332588685173,      1.8732607199338023,     1.903386240696263,
    1.9348067384546397,     1.9676321374419985,     2.0019868622411097,
    2.038012496606986,      2.0758710799158004,     2.1157492338135104,
    2.157863383060159,      2.2024664379151466,     2.2498564578052798,
    2.3003880451598637,     2.354487570644892,      2.4126738866070387,
    2.4755870863360063,     2.5440293747637366,     2.619024734483301,
    2.7019088135471767,     2.7944694895185127,     2.899176797803582,
    3.0195804879399892,     3.1610474401586304,     3.332261695301172,
    3.5486912140325937,     3.8422918584780588,     4.299511456383946,
    5.539093437027215,
};

const uintf SYMMETRY_NUM = 8;
const uintf BOARD_SIZE = 16;

// Don't include the identity transformation
const uintf space_symmetries[SYMMETRY_NUM - 1][BOARD_SIZE] = {
    {3, 2, 1, 0, 7, 6, 5, 4, 11, 10, 9, 8, 15, 14, 13, 12},
    {12, 8, 4, 0, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3},
    {0, 4, 8, 12, 1, 5, 9, 13, 2, 6, 10, 14, 3, 7, 11, 15},
    {15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0},
    {12, 13, 14, 15, 8, 9, 10, 11, 4, 5, 6, 7, 0, 1, 2, 3},
    {3, 7, 11, 15, 2, 6, 10, 14, 1, 5, 9, 13, 0, 4, 8, 12},
    {15, 11, 7, 3, 14, 10, 6, 2, 13, 9, 5, 1, 12, 8, 4, 0},
};

const uintf move_symmetries[SYMMETRY_NUM - 1][NUM_MOVES] = {
    {26, 25, 24, 29, 28, 27, 32, 31, 30, 35, 34, 33, 15, 14, 13, 12,
     19, 18, 17, 16, 23, 22, 21, 20, 2,  1,  0,  5,  4,  3,  8,  7,
     6,  11, 10, 9,  39, 38, 37, 36, 43, 42, 41, 40, 47, 46, 45, 44,
     51, 50, 49, 48, 55, 54, 53, 52, 59, 58, 57, 56, 63, 62, 61, 60,
     67, 66, 65, 64, 71, 70, 69, 68, 75, 74, 73, 72, 79, 78, 77, 76,
     83, 82, 81, 80, 87, 86, 85, 84, 91, 90, 89, 88, 95, 94, 93, 92},
    {15, 19, 23, 14, 18, 22, 13, 17, 21, 12, 16, 20, 26, 29, 32, 35,
     25, 28, 31, 34, 24, 27, 30, 33, 39, 43, 47, 38, 42, 46, 37, 41,
     45, 36, 40, 44, 2,  5,  8,  11, 1,  4,  7,  10, 0,  3,  6,  9,
     51, 55, 59, 63, 50, 54, 58, 62, 49, 53, 57, 61, 48, 52, 56, 60,
     67, 71, 75, 79, 66, 70, 74, 78, 65, 69, 73, 77, 64, 68, 72, 76,
     83, 87, 91, 95, 82, 86, 90, 94, 81, 85, 89, 93, 80, 84, 88, 92},
    {12, 16, 20, 13, 17, 21, 14, 18, 22, 15, 19, 23, 0,  3,  6,  9,
     1,  4,  7,  10, 2,  5,  8,  11, 36, 40, 44, 37, 41, 45, 38, 42,
     46, 39, 43, 47, 24, 27, 30, 33, 25, 28, 31, 34, 26, 29, 32, 35,
     48, 52, 56, 60, 49, 53, 57, 61, 50, 54, 58, 62, 51, 55, 59, 63,
     64, 68, 72, 76, 65, 69, 73, 77, 66, 70, 74, 78, 67, 71, 75, 79,
     80, 84, 88, 92, 81, 85, 89, 93, 82, 86, 90, 94, 83, 87, 91, 95},
    {35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 47, 46, 45, 44,
     43, 42, 41, 40, 39, 38, 37, 36, 11, 10, 9,  8,  7,  6,  5,  4,
     3,  2,  1,  0,  23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12,
     63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49, 48,
     79, 78, 77, 76, 75, 74, 73, 72, 71, 70, 69, 68, 67, 66, 65, 64,
     95, 94, 93, 92, 91, 90, 89, 88, 87, 86, 85, 84, 83, 82, 81, 80},
    {9,  10, 11, 6,  7,  8,  3,  4,  5,  0,  1,  2,  44, 45, 46, 47,
     40, 41, 42, 43, 36, 37, 38, 39, 33, 34, 35, 30, 31, 32, 27, 28,
     29, 24, 25, 26, 20, 21, 22, 23, 16, 17, 18, 19, 12, 13, 14, 15,
     60, 61, 62, 63, 56, 57, 58, 59, 52, 53, 54, 55, 48, 49, 50, 51,
     76, 77, 78, 79, 72, 73, 74, 75, 68, 69, 70, 71, 64, 65, 66, 67,
     92, 93, 94, 95, 88, 89, 90, 91, 84, 85, 86, 87, 80, 81, 82, 83},
    {44, 40, 36, 45, 41, 37, 46, 42, 38, 47, 43, 39, 9,  6,  3,  0,
     10, 7,  4,  1,  11, 8,  5,  2,  20, 16, 12, 21, 17, 13, 22, 18,
     14, 23, 19, 15, 33, 30, 27, 24, 34, 31, 28, 25, 35, 32, 29, 26,
     60, 56, 52, 48, 61, 57, 53, 49, 62, 58, 54, 50, 63, 59, 55, 51,
     76, 72, 68, 64, 77, 73, 69, 65, 78, 74, 70, 66, 79, 75, 71, 67,
     92, 88, 84, 80, 93, 89, 85, 81, 94, 90, 86, 82, 95, 91, 87, 83},
    {47, 43, 39, 46, 42, 38, 45, 41, 37, 44, 40, 36, 35, 32, 29, 26,
     34, 31, 28, 25, 33, 30, 27, 24, 23, 19, 15, 22, 18, 14, 21, 17,
     13, 20, 16, 12, 11, 8,  5,  2,  10, 7,  4,  1,  9,  6,  3,  0,
     63, 59, 55, 51, 62, 58, 54, 50, 61, 57, 53, 49, 60, 56, 52, 48,
     79, 75, 71, 67, 78, 74, 70, 66, 77, 73, 69, 65, 76, 72, 68, 64,
     95, 91, 87, 83, 94, 90, 86, 82, 93, 89, 85, 81, 92, 88, 84, 80},
};

#endif